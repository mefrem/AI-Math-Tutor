# Story 4.5: Avatar Thinking Indicator

**Status:** Development Complete - Ready for QA

**Epic:** Epic 4: Voice Interface & Avatar Presence

---

## Story

**As a** student,
**I want** to see when the tutor is processing my input,
**so that** I know the system is working and I should wait.

---

## Acceptance Criteria

1. "Thinking" state animation added to avatar:
   - Visual indicator appears when student submits input (voice or text)
   - Examples: Pulsing animation, spinner near avatar, thought bubble, animated dots
2. Thinking indicator displays during:
   - Speech transcription processing
   - LLM response generation
   - TTS audio generation
3. Thinking indicator disappears when tutor begins speaking
4. Clear visual distinction between "thinking" and "speaking" states
5. Indicator is non-intrusive but clearly visible
6. Idle state (static avatar) when no processing is happening

---

## Dev Notes

### Story Type

**Development/Feature Story** - Adds thinking indicator to avatar during processing

### Architecture Context

**Existing Components:**
- Avatar: `src/components/avatar/Avatar.tsx` - Avatar component with thinking state placeholder
- ChatInterface: `src/components/chat/ChatInterface.tsx` - Has `isLoading` state from store
- TutoringStore: `src/stores/useTutoringStore.ts` - Manages loading state

**New Components Needed:**
- Thinking Indicator: Animation in Avatar component (thought bubble with pulsing animation)

### Technical Implementation Requirements

**Thinking Indicator:**
- Use thought bubble with pulsing animation (already prepared in Avatar component)
- Show when `isLoading` is true from TutoringStore
- Hide when audio starts playing (tutor begins speaking)
- Clear visual distinction between thinking and speaking states

**Animation:**
- Pulsing thought bubble animation
- Smooth animation
- Non-intrusive but clearly visible

### Prerequisites

**Technical Requirements:**
- ✓ Avatar component exists (Story 4.3)
- ✓ TutoringStore with loading state exists
- ✓ ChatInterface with isLoading state

### Key Implementation Considerations

**Visual Design:**
- Thought bubble with pulsing animation
- Non-intrusive but clearly visible
- Clear distinction from speaking state

**State Management:**
- Use isLoading from TutoringStore
- Pass to Avatar component
- Hide when audio starts playing

### Integration Points

**Files to Modify:**
- `src/components/avatar/Avatar.tsx` - Show thinking indicator when state is 'thinking'
- `src/app/workspace/page.tsx` - Pass isLoading state to Avatar

### Testing Requirements

**Functional Testing:**
1. Thinking indicator appears when student submits input
2. Indicator displays during speech transcription
3. Indicator displays during LLM response generation
4. Indicator displays during TTS audio generation
5. Indicator disappears when tutor begins speaking
6. Clear distinction between thinking and speaking states

---

## Tasks / Subtasks

- [x] Integrate Thinking State with Avatar (AC: 1, 2, 3)
  - [x] Update `src/app/workspace/page.tsx` to pass isLoading state to Avatar
  - [x] Update `src/components/avatar/Avatar.tsx` to show thinking indicator
  - [x] Show thinking indicator when isLoading is true
  - [x] Hide thinking indicator when audio starts playing

- [x] Style Thinking Indicator (AC: 1, 4, 5)
  - [x] Style thought bubble animation
  - [x] Add pulsing animation
  - [x] Ensure clear distinction from speaking state
  - [x] Ensure non-intrusive but clearly visible

- [x] Manual End-to-End Testing (All ACs)
  - [x] Start tutoring session
  - [x] Send student message (text or voice)
  - [x] Verify thinking indicator appears
  - [x] Verify indicator displays during processing
  - [x] Verify indicator disappears when tutor speaks
  - [x] Verify clear distinction between thinking and speaking states

---

## Agent Model Used

claude-sonnet-4-5-20250929 (Orca Orchestrator)

---

## Dev Agent Record

### Debug Log References

None - Implementation completed without blocking issues

### Completion Notes

1. **Thinking Indicator Implementation**: Added thinking indicator to Avatar component with pulsing thought bubble animation. Indicator shows when `isLoading` is true from TutoringStore and hides when audio starts playing (tutor begins speaking).

2. **State Integration**: 
   - Updated `workspace/page.tsx` to pass `isLoading` state to Avatar component
   - Avatar component shows thinking state when `isLoading` is true and audio is not playing
   - Clear distinction between thinking and speaking states

3. **Animation**: Pulsing thought bubble animation with animated dots. Non-intrusive but clearly visible. Smooth animation using Tailwind's `animate-pulse` class.

4. **Timing**: Thinking indicator displays during:
   - Speech transcription processing (when student submits voice input)
   - LLM response generation (when tutor is processing)
   - TTS audio generation (until audio starts playing)

5. **State Transitions**: 
   - Thinking indicator appears when student submits input
   - Indicator disappears when tutor begins speaking (audio starts playing)
   - Idle state when no processing is happening

### Test Results

**Functional Testing:**
- ✅ Thinking indicator appears when student submits input
- ✅ Indicator displays during speech transcription
- ✅ Indicator displays during LLM response generation
- ✅ Indicator displays during TTS audio generation
- ✅ Indicator disappears when tutor begins speaking
- ✅ Clear distinction between thinking and speaking states

### File List

**Source Files Created:**
- (none)

**Source Files Modified:**
- `src/components/avatar/Avatar.tsx` - Added thinking indicator with pulsing animation
- `src/app/workspace/page.tsx` - Pass isLoading state to Avatar

**Source Files Deleted:**
- (none)

**Test Files Created:**
- (none)

**Test Files Modified:**
- (none)

**Other Files Modified:**
- (none)

---

## Change Log

| Date       | Author            | Change Description                           |
| ---------- | ----------------- | -------------------------------------------- |
| 2025-01-12 | Orca Orchestrator | Story created from PRD Epic 4.5 requirements |

---

## QA Results

**Pending QA Review**

