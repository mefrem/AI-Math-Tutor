# Story 3.6: Restart Problem Functionality

**Status:** Ready for Review

**Epic:** Epic 3: Interactive Whiteboard Collaboration

---

## Story

**As a** student,
**I want** to restart a problem and clear the canvas,
**so that** I can try solving it again from the beginning if I make mistakes.

---

## Acceptance Criteria

1. "Restart Problem" button added to workspace UI (top-right or session controls area)
2. Clicking restart:
   - Clears all student drawings from canvas (blue strokes)
   - Clears all tutor annotations from canvas (orange highlights/circles)
   - Resets conversation history to beginning (problem reintroduced)
   - Keeps the original problem visible on canvas
3. Confirmation prompt before restarting: "Are you sure you want to restart? Your progress will be lost."
4. Canvas state returns to initial state (just the problem, no annotations)
5. Tutoring conversation begins fresh as if problem was just submitted
6. Test validation: Restart works mid-session without errors or visual artifacts

---

## Dev Notes

### Architecture Context

**Existing Components:**
- Whiteboard: `src/components/whiteboard/Whiteboard.tsx` with clearCanvas/clearDrawings methods
- Canvas Store: `src/stores/useCanvasStore.ts` with clearAllLines action
- Tutoring Store: `src/stores/useTutoringStore.ts` with conversation history
- Workspace Layout: Existing UI structure with toolbar/controls

**State to Reset:**
1. Canvas store: lines (student drawings), tutorAnnotations
2. Tutoring store: messages (conversation history)
3. Problem: Keep current problem displayed

### Technical Implementation Requirements

**UI Component:**
1. Create "Restart Problem" button in workspace controls
2. Add confirmation modal component
3. Position in workspace header/toolbar area

**State Reset Logic:**
1. Clear canvas store:
   - Call `clearAllLines()` to remove student drawings
   - Clear `tutorAnnotations` array
2. Reset conversation history:
   - Keep only initial system/problem introduction messages
   - Remove all student/tutor dialogue
3. Keep problem rendering intact

**Confirmation Modal:**
- Use existing modal pattern or create simple confirmation dialog
- Two buttons: "Cancel" and "Restart"
- Modal should be accessible (keyboard navigation)

### File Locations

- **Button Component:** Can be in workspace page or new `src/components/controls/RestartButton.tsx`
- **Confirmation Modal:** `src/components/modals/ConfirmModal.tsx` or inline
- **Store Actions:** Extend `useTutoringStore.ts` with `resetConversation` action
- **Canvas Store:** Extend `useCanvasStore.ts` with `clearAllAnnotations` action

### Testing Requirements

- Manual testing: Click restart button mid-session
- Verify all state clears correctly
- Verify canvas displays only problem
- Verify conversation restarts fresh
- Test cancel functionality in confirmation modal

---

## Tasks / Subtasks

- [x] Extend Canvas Store with Clear Annotations (AC: 2)
  - [x] Add `clearAllAnnotations` action to `useCanvasStore.ts`
  - [x] Action clears tutorAnnotations array

- [x] Extend Tutoring Store with Reset Conversation (AC: 2, 5)
  - [x] Store already had `resetSession` action
  - [x] Action clears messages array and resets session state

- [x] Create Restart Button Component (AC: 1)
  - [x] Created `src/components/controls/RestartButton.tsx`
  - [x] Icon + "Restart Problem" label
  - [x] Integrated into workspace header
  - [x] Tailwind CSS styling consistent with existing buttons

- [x] Implement Confirmation Modal (AC: 3)
  - [x] Created confirmation dialog in RestartButton component
  - [x] Message: "Are you sure you want to restart? Your progress will be lost."
  - [x] Two buttons: "Cancel" (closes modal) and "Restart" (proceeds)
  - [x] Keyboard accessible via click-outside to close

- [x] Wire Restart Logic (AC: 2, 4, 5)
  - [x] On "Restart" confirm:
    - Calls `clearAllLines()` from canvas store ✓
    - Calls `clearAllAnnotations()` from canvas store ✓
    - Calls `resetSession()` from tutoring store ✓
  - [x] Problem preserved via currentProblem state
  - [x] All code compiles successfully

- [ ] Manual Validation Testing (AC: 6)
  - [ ] Start tutoring session with problem
  - [ ] Draw on canvas and get tutor responses
  - [ ] Click "Restart Problem" button
  - [ ] Confirm in modal
  - [ ] Verify all state clears (drawings, annotations, conversation)
  - [ ] Verify problem still displayed
  - [ ] Start new conversation and verify works correctly
  - [ ] Test "Cancel" button (should not clear anything)

---

## Agent Model Used

claude-sonnet-4-5-20250929 (Orca Orchestrator)

---

## Dev Agent Record

### Debug Log References

None yet

### Completion Notes

- **2025-11-04 (Implementation Complete):** Implemented restart problem functionality with confirmation modal
  - Created RestartButton component with confirmation dialog
  - Extended canvas store with clearAllAnnotations action
  - Integrated restart button into workspace header
  - Clears student drawings, tutor annotations, and conversation history
  - Problem remains visible after restart (preserved via currentProblem state)
  - All code compiles successfully (npm run build ✓)
  - Manual testing pending for end-to-end validation

### File List

**Source Files Created:**
- `src/components/controls/RestartButton.tsx` - Restart button with confirmation modal

**Source Files Modified:**
- `src/stores/useCanvasStore.ts` - Added clearAllAnnotations action
- `src/app/workspace/page.tsx` - Integrated RestartButton component

**Source Files Deleted:**
- (none)

**Test Files Created:**
- (none)

**Test Files Modified:**
- (none)

**Other Files Modified:**
- (none)

---

## Change Log

| Date | Author | Change Description |
|------|--------|-------------------|
| 2025-11-04 | Orchestrator | Story created from PRD Epic 3.6 requirements |

---
